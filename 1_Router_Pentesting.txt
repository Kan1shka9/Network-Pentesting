Router Pentesting

+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

Software Vulnerabilities
1.) Rare and fixed soon
2.) Exploit Research

Faulty by design
1.) Difficult to find for mature products
2.) Reversing firmware images and testing

Configuration Flaws
1.) Very common
2.) As secure as the team implementing it

List of Configuration Flaws
1.) Attacking admin services
* SSH, Telnet
* HTTPD
* SNMP
2.) Routing Attacks
- RIP
- OSPF
- BGP

+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

Default Username and Password
vyatta
vyatta

+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

Installing vyatta
$ install image

+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

Set IP address for vyatta
$ configure
# set interfaces ethernet eth0 address 192.168.1.101/24
# commit
# save
# show interfaces

+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

Configure SSH
$ configure
# set service ssh
# commit
# save

+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

vyatta@vyatta:~$ show configuration
interfaces {
    ethernet eth0 {
        address 192.168.1.101/24
        duplex auto
        hw-id 00:0c:29:77:a7:10
        smp_affinity auto
        speed auto
    }
    loopback lo {
    }
}
service {
    ssh {
    }
}
system {
    config-management {
        commit-revisions 20
    }
    console {
        device ttyS0 {
            speed 9600
        }
    }
    host-name vyatta
    login {
        user vyatta {
            authentication {
                encrypted-password ****************
            }
            level admin
        }
    }
    ntp {
        server 0.vyatta.pool.ntp.org {
        }
        server 1.vyatta.pool.ntp.org {
        }
        server 2.vyatta.pool.ntp.org {
        }
    }
    package {
        auto-sync 1
        repository community {
            components main
            distribution stable
            password ****************
            url http://packages.vyatta.com/vyatta
            username ""
        }
    }
    syslog {
        global {
            facility all {
                level notice
            }
            facility protocols {
                level debug
            }
        }
    }
    time-zone GMT
}
vyatta@vyatta:~$

+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

Setup SSH, Telnet, SNMP
$ configure
# set service ssh
# set service telnet
# set service https
# set service snmp
# set service snmp community public
# set service snmp community public authorization ro
# set service snmp community private authorization rw
# commit
# save

+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

In Kali
1.) TCP Scan
$ nmap -sV -n 192.168.1.101

Starting Nmap 7.25BETA2 ( https://nmap.org ) at 2017-02-28 12:38 EST
Nmap scan report for 192.168.1.101
Host is up (0.00083s latency).
Not shown: 996 closed ports
PORT    STATE SERVICE  VERSION
22/tcp  open  ssh      OpenSSH 5.5p1 Debian 6+squeeze3 (protocol 2.0)
23/tcp  open  telnet   Vyatta router telnetd 1.14.0 or later
80/tcp  open  http     lighttpd 1.4.28
443/tcp open  ssl/http lighttpd 1.4.28
MAC Address: 00:0C:29:77:A7:10 (VMware)
Service Info: OS: Linux; Device: router; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 12.88 seconds

2.) UDP Scan
$ nmap -sU -p 161 -sV -n 192.168.1.101

Starting Nmap 7.25BETA2 ( https://nmap.org ) at 2017-02-28 12:44 EST
Nmap scan report for 192.168.1.101
Host is up (0.00048s latency).
PORT    STATE SERVICE VERSION
161/udp open  snmp    SNMPv1 server; net-snmp SNMPv3 server (public)
MAC Address: 00:0C:29:77:A7:10 (VMware)
Service Info: Host: vyatta

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 0.77 seconds

+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

Enumeration

SSH
ssh vyatta@192.168.1.101
The authenticity of host '192.168.1.101 (192.168.1.101)' can't be established.
RSA key fingerprint is SHA256:GxLlb4qyM8g2fchXYk0IU1FAic0EUdOI0SRuREweuMw.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '192.168.1.101' (RSA) to the list of known hosts.
Welcome to Vyatta
vyatta@192.168.1.101's password:
Linux vyatta 3.3.8-1-586-vyatta #1 SMP Wed Mar 13 10:35:45 PDT 2013 i686
Welcome to Vyatta.
This system is open-source software. The exact distribution terms for
each module comprising the full system are described in the individual
files in /usr/share/doc/*/copyright.
Last login: Tue Feb 28 09:39:40 2017
vyatta@vyatta:~$ 

Telnet
$ nc 192.168.1.101 23
��������
Welcome to Vyatta
vyatta login: vyatta
vyatta
Password: vyatta

Last login: Tue Feb 28 08:00:01 GMT 2017 from 192.168.1.10 on pts/0
Linux vyatta 3.3.8-1-586-vyatta #1 SMP Wed Mar 13 10:35:45 PDT 2013 i686
Welcome to Vyatta.
This system is open-source software. The exact distribution terms for
each module comprising the full system are described in the individual
files in /usr/share/doc/*/copyright.
vyatta@vyatta:~$ exit
exit
logout

HTTP
In Browser
192.168.1.101

SNMP
-sC -> runs nmap scripts
$ nmap -sU -p 161 -sV -sC -n 192.168.1.101

Starting Nmap 7.25BETA2 ( https://nmap.org ) at 2017-02-28 12:45 EST
Nmap scan report for 192.168.1.101
Host is up (0.00047s latency).
PORT    STATE SERVICE VERSION
161/udp open  snmp    SNMPv1 server; net-snmp SNMPv3 server (public)
| snmp-info:
|   enterprise: net-snmp
|   engineIDFormat: unknown
|   engineIDData: 86d631386037b558
|   snmpEngineBoots: 1
|_  snmpEngineTime: 1h05m43s
| snmp-sysdescr: Vyatta VC6.6R1
|_  System uptime: 1h05m43.38s (394338 timeticks)
MAC Address: 00:0C:29:77:A7:10 (VMware)
Service Info: Host: vyatta

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 1.00 seconds

Make SNMP Secure
$ configure
# delete service snmp community public
# set service snmp community public2 authorization ro
# commit
# save

Nmap Scan
$ nmap -sU -p 161 -sV -n -sC 192.168.1.101

Starting Nmap 7.25BETA2 ( https://nmap.org ) at 2017-02-28 12:50 EST
Nmap scan report for 192.168.1.101
Host is up (0.00045s latency).
PORT    STATE SERVICE VERSION
161/udp open  snmp    net-snmp; net-snmp SNMPv3 server
| snmp-info:
|   enterprise: net-snmp
|   engineIDFormat: unknown
|   engineIDData: 449a1b3ec947b558
|   snmpEngineBoots: 1
|_  snmpEngineTime: 37s
MAC Address: 00:0C:29:77:A7:10 (VMware)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 15.76 seconds

+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
